image:
  distribution: ubuntu
  release: focal

source:
  downloader: rootfs-http

targets: {}

mappings:
  architecture_map: debian

packages:
  manager: apt
  update: true
  cleanup: true
  sets:
  - packages:
    - fuse
    - language-pack-en
    - openssh-client
    - sudo
    - vim
    action: install

  - packages:
    - ubuntu-desktop-minimal
    action: install

  - packages:
    # Disables the welcome screen
    - gnome-initial-setup
    action: remove

  - packages:
    # For connecting via RDP
    - xrdp
    action: install

files:
# Stops offering to upgrade
- path: /etc/update-manager/release-upgrades
  generator: dump
  content: |-
    [DEFAULT]
    Prompt=never

actions:
# Modifies to show Ubuntu Dock
- trigger: post-packages
  action: |-
    #!/bin/sh
    set -eux

    sed -i '5 i export GNOME_SHELL_SESSION_MODE=ubuntu\nexport XDG_CURRENT_DESKTOP=ubuntu:GNOME\n' /etc/xrdp/startwm.sh
